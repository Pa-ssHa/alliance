<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Подтверждение номера</title>
    <!-- Подключаем Firebase и Firebase UI -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.css" />
    <script src="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.js"></script>
</head>
<body>
<div id="firebaseui-auth-container"></div>

<script>
    // Конфигурация Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyAiClNA1OYlHwhGsG8JStQ2DEnlNHHb16c",
        authDomain: "alliance-2490a.firebaseapp.com",
        projectId: "alliance-2490a",
        storageBucket: "alliance-2490a.firebasestorage.app",
        messagingSenderId: "909915657042",
        appId: "1:909915657042:web:aa9b6a450f74d61a18e08b",
        measurementId: "G-3CZCP8FFHT"
    };

    // Инициализация Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // Конфигурация Firebase UI
    const uiConfig = {
        signInOptions: [
            {
                provider: firebase.auth.PhoneAuthProvider.PROVIDER_ID,
                recaptchaParameters: {
                    type: 'image', // или 'audio'
                    size: 'normal', // или 'invisible'
                    badge: 'bottomleft' // или 'inline'
                },
                defaultCountry: 'RU' // Код страны по умолчанию
            }
        ],
        callbacks: {
            signInSuccessWithAuthResult: function(authResult, redirectUrl) {
                // Пользователь успешно вошел
                console.log("Пользователь вошел:", authResult.user);

                // Получаем ID токен и отправляем на сервер
                authResult.user.getIdToken().then((idToken) => {
                    fetch('/verify-id-token', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ idToken: idToken })
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                alert("Аутентификация успешна!");
                                window.location.href = "/realty"; // Перенаправление на главную страницу
                            } else {
                                alert("Ошибка аутентификации.");
                            }
                        });
                });

                return false; // Не перенаправлять на другую страницу
            },
            signInFailure: function(error) {
                // Обработка ошибок
                console.error("Ошибка входа:", error);
                alert("Ошибка при входе: " + error.message);
            }
        }
    };

    // Инициализация Firebase UI
    const ui = new firebaseui.auth.AuthUI(auth);
    ui.start('#firebaseui-auth-container', uiConfig);
</script>
</body>
</html>